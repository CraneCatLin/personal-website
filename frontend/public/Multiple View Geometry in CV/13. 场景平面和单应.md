对于两个（像）平面，有两种映射  
A平面的点到B平面的线：基本矩阵映射  
A平面的点到B平面的点：二维射影映射  
  
在后一种更一般的映射中，相当于有一个场景平面作为中转  
  
## 视差  
#### 概念  
虚拟视差  
$X$映射到平面A的$x$，映射到平面B的$x'$  
两点连线交世界平面$\pi$于$X'$，映射到A同样是$x$，但映射到B是$\tilde{x}'$，  
$x'$和$\tilde{x}'$的距离称为$\pi$诱导的视差  
  
#### 应用-6点法求F  
给定6组点对应$x_i \leftrightarrow x'_i$，它们是3D空间中的点$X_i$的图像，且前4个3D点$(i \in \{1, \cdots, 4\})$共面，确定基本矩阵$F$，其余两个点不在此平面上  
  
(1) 计算单应$H$，使得$x'_i = Hx_i, i \in \{1, \cdots, 4\}$。  
(2) 确定作为直线$(Hx_5) \times x'_5$和$(Hx_6) \times x'_6$的交点的对极点$e'$。  
(3) $F = [e']_\times H$。  
#### 应用-射影深度  
世界点$X = (x^T, \rho)^T$被成像在第一幅视图中的$x$和第二幅视图中的$x' = Hx + \rho e'$  
注意，$x'$, $e'$和$Hx$共线。标量$\rho$是相对于单应$H$的视差，并且可以解释为相对于平面$\pi$的"深度"。若$\rho = 0$，则3D点$X$在平面上，否则$\rho$的"正负号"将表示点$X$在平面$\pi$的哪"边"。注意在非定向射影几何下，一个齐次对象的符号和一个平面的两边没有意义。  
  
#### 应用-空间二分  
虚拟视差的正负可以划分对应点在$\pi$的两侧  
$\pi$的位置可以用于划分区域  
  
## 给定平面的单应和逆问题  
对于一般位置（不包含光心）的一个平面，有一个非退化的单应与之相互唯一确定  
  
## 求单应  
已知F，给定不同额外信息，求H  
#### 由平面到单应  
按照$\pi_1 \to \pi \to \pi_2$的顺序推导即可  
给定两幅视图的投影矩阵$P = [I | 0], \quad P' = [A | a]$和由$\pi^T x = 0$定义的平面$\pi$  
由于平面不通过第一个摄像机的中心$(0, 0, 0, 1)^T$，我们可以假定$\pi_4 = 1$  
则$\pi = (v^T, 1)^T$  
$v$不是齐次3维向量，而是一个一般三维参数向量  
由$\pi$诱导的单应是$x' = Hx$，其中$H = A - av^T$  
  
对于已标定情况：  
两摄像机为$P_E = K[I|0], \quad P'_E = K'[R|t]$  
世界平面$\pi_E$的坐标是$\pi_E = (n^T, d)^T$,即该平面上的点满足$n^T \bar{X} + d = 0$  
由$\nu = n/d$，对图像施加变换$K$和$K'$  
则诱导的单应是$H = K'(R - tn^T/d)K^{-1}$  
  
#### 由F（对极）到单应  
场景平面映射到两幅图像上，有四组对应点$x_i \leftrightarrow x'_i$，可以确定一个由该场景平面诱导的单应$H$  
则对应点均满足$x \leftrightarrow x' = Hx$和$x'^T_i F x_i = 0$  
称这样的单应H与F相容  
H与F相容等价于H可由平面诱导  
  
结论：一个单应$H$与一个基本矩阵$F$相容的充要条件是矩阵$H^T F$是反对称的，即$H^T F + F^T H = 0$  
证明略  
  
结论：给定两幅视图之间的基本矩阵$F$，由一张世界平面诱导的3参数族单应是：$H = A - e' v^T$  
式中，$[e']_\times A = F$是基本矩阵的任意分解  
可由平面到单应的结论证明  
  
推论：一个变换$H$是由某世界平面诱导的两幅图像之间的单应当且仅当这两幅图像的基本矩阵$F$有一个分解式：$F = [e']_\times H$  
#### 由F和图像对应到单应  
一般位置的三点，或一直线一点，可以确定一个平面。  
因此可以直接用图像对应元素计算单应，跳过平面这步  
此处的对应元素均满足对极几何一致性约束  
下面分类详述  
#### 三点法  
已知F，已知三个不共线三维点各自的一对像点  
  
可以由对应直接联立求解H（隐式法），但是受退化影响大  
因此考虑显式法  
  
**显式法**：  
已知F时，有分解$[e']_\times A = F$，$H = A - e' v^T$，只需通过三组对应点求v  
最终求得Mv=b，M不满秩时无解（即三像点共线），此时单应没有满秩解  
有解时$v=M^{-1}b$  
$b$是一个3维向量，其元素为  
  
$$b_i = (x'_i \times (Ax_i))^T (x'_i \times e')/\|x'_i \times e'\|^2$$  
而$M$是一个行向量为$x_i^T$的$3\times 3$矩阵  
综上$$H = A - e' (M^{-1}b)^T$$  
**一致性条件**  
考虑对极约束，等价于像点、对极点连线为对极线的约束  
即$e' \times x'_i = e' \times A x_i = F x_i$  
  
**由噪声点估计**  
考虑测量点的误差，测量点对不一定满足对极约束  
通过最优矫正使得$\hat{x}_i \leftrightarrow \hat{x}'_i$满足对极几何约束，参考12章  
  
**三点法总结**  
对每组对应点$x_i \leftrightarrow x'_i$用12章的矫正算法得到$\hat{x}_i \leftrightarrow \hat{x}'_i$  
分解F得到$F=[e']_\times A$  
解方程组Mv=b得到v  
代入$H = A - e' v^T$得到H  
#### 一点与一直线  
一对像直线反向投影交于三维直线，该三维直线定义一个平面束，束的任意元素可以诱导两像直线直接的映射  
  
如果$I'^T e' \neq 0$，则由直线对应$I \leftrightarrow I'$定义的平面束诱导的单应是  
  
$$H(\mu) = [I']_\times F + \mu e' I^T$$  
式中，$\mu$是射影参数。  
  
**点与直线到单应**  
给定$F$及对应点$x \leftrightarrow x'$和对应直线$l \leftrightarrow l'$，由相应3D点和直线所在平面所诱导的单应是  
  
$$H = [l']_\times F + \frac{(x' \times e')^T (x' \times ((Fx) \times l'))}{\|x' \times e'\|^2 (l^T x)} e' l^T$$  
同样要求像元素满足对极关系，所以需要先矫正；但是缺少对直线的一致性约束和矫正方法  
  
**退化单应**  
场景平面包含至少一个摄像机中心时单应不满秩，即退化  
但仍可以用$H(\mu) = [I']_\times F + \mu e' I^T$求退化单应的显式表达式  
$\mu=\infty$和$\mu=0$分别对应场景平面过两个光心的情况  
  
  
## 求平面  
已知H，给定额外信息，求平面  
（似乎没提？待证 #todo ）  
参考视差内容  
  
## 无穷单应  
由无穷远平面$\pi_{\infty}$诱导的单应称为无穷单应$H_{\infty}$  
由平面到单应：$H = K' (R - tn^T / d)K^{-1}$  
从而有  
  
$$H_{\infty} = \lim_{d \to \infty} H = K' RK^{-1}$$  
  
$$x' = K' RK^{-1}x + K' t / Z = H_{\infty} x + K' t / Z=H_{\infty} x + e' / Z$$  
Z是第一个摄像机测量的深度  
对比$x' = Hx + \rho e'$，可知欧式深度的倒数为相当于无穷远平面的视差  
  
#### 消影点与消影线  
无穷单应映射无穷远平面上的点，映射为消影点  
因此可以由三个不共线的无穷远点和F计算无穷单应  
  
#### 仿射与度量重构  
无穷远平面可以使射影重构变为仿射重构  
在仿射世界坐标系下，已知$P = [M \mid m]$和$P' = [M' \mid m']$，则$H_{\infty} = M'M^{-1}$  
  
无穷单应可以传递标定  
一幅图中$\omega = (KK^T)^{-1}$已知，另一幅图的$\omega' = H_{\infty}^{-T}\omega H_{\infty}^{-1}$，进而$\omega' = (K'K'^T)^{-1}$分解得到标定  
  
#### 立体对应  
无穷单应是场景平面中最远的，相应可以在对极线上截出一个最远点，结合对极点，使得搜索对应点变为在二者之间的有限线段上搜索  