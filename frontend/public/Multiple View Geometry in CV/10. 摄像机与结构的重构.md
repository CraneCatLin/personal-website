结构指场景布局  
本章为两视图恢复摄像机与场景布局  
  
## 概述  
由对应点出发：  
#### 点对计算基本矩阵  
若已标定则可变为计算本质矩阵  
#### 基本矩阵分解得摄像机矩阵  
  
#### 利用摄像机矩阵映射回三维坐标  
由点对反向投影的射线相交得到三维点  
  
## 多义性  
有一任意射影变换矩阵H，同时作用于三维点（左乘H）和摄像机（右乘H逆）上时，映射结果不变（结论a）  
可以计算出相似变换不改变摄像机矩阵的标定矩阵而仿射/射影变换会（结论b）  
所以上述对已标定和未标定均有效  
  
由结论a、b可以证明对于标定摄像机重构多义性仅为相差一个相似变换  
  
但对于未标定矩阵，由于不受结论b约束，所以仅由结论a重构多义性扩大为相差一个射影变换  
  
相差一个射影/仿射/相似变换的重构结构称为射影/仿射/相似重构  
仿射重构又称度量重构/欧式重构  
  
由此有射影重构定理  
**射影重构定理**  
由对应点唯一确定基本矩阵后，重构出的两组结果$(P_1, P_1', \{X_{1i}\})$ 和 $(P_2, P_2', \{X_{2i}\})$是射影重构  
特殊情况：三维点在摄像机中心连线上时则不能确定三维点的位置，此时像点在对极点  
  
## 分层重构  
以下每个新重构均在上一层基础上  
#### 射影重构  
由对应点求基本矩阵，由基本矩阵恢复一对摄像机矩阵，由对应点、摄像机矩阵三角测量恢复三维点  
#### 仿射重构  
关键：通过一些方法确定射影空间中一平面$\pi$为无穷远平面  
  
求使 $\pi$ 映射到 $(0, 0, 0, 1)^T$ 的射影变换H，即$H^{-T} \pi = (0, 0, 0, 1)^T$  
由此$$H = \begin{bmatrix}I |0 \\\pi^T\end{bmatrix}$$  
若$\pi$最后一位为0则不能套用此公式，此时$H^{-T}$ 可作为满足$H^{-T} \pi = (0,0,0,1)^T$ 的 Householder 矩阵来计算，进而求得H  
  
利用H可以将射影重构变换到仿射重构  
  
确定无穷远平面的方法/情况：  
  
**纯平移运动**  
纯平移时，无穷远点在两图像映射的像点坐标相同  
由此任意选择一像点，即可令此点为无穷远点的像，由已知的射影重构的变换得到三维点。三个这样的点可以确定无穷远平面，进而求仿射重构。  
可以理解为人为指定一个平面为无穷远平面，由此即可确定一个仿射重构  
此时由于F具有一些特殊性质，参考基本矩阵里对纯平移的描述，$F = [e]_\times = [e']_\times$，对应仿射重构可选的一组摄像机为$P = [I|0]$ 和 $P' = [I|e']$  
  
**平行直线**  
平行线-3组消影点-3个无穷远点-无穷远平面  
求一组消影点时，先在一张图用平行线l和l‘求一个点v，另一张图可以用对极线Fv交l求另一个点  
求无穷远点X时，由上描述，方程可写为$([v]_\times P)X = 0$ 和 $(l'^T P')X = 0$  
  
**其他场景约束**  
参考射影几何中求消影点和消影线的各种方法  
  
**无穷单应**  
像点$x$反向投影射线交无穷远平面于$X$，$X$映射到另一个像平面上的$x'$  
则满足$x' = H_\infty x$的单应$H_\infty$为无穷单应  
给定仿射重构中摄像机$P = [M | m]$ 和 $P' = [M' | m']$，则$H_\infty = M'M^{-1}$  
无穷单应仿射不变，由此确定无穷单应等价于确定仿射重构  
$H_\infty \Leftrightarrow P = [I | 0] \& P' = [H_\infty | e']$，注意这只是一种可选取法  
无穷单应可以直接由若干组对应元素求得  
  
**一个摄像机为仿射摄像机**  
该摄像机主平面为无穷远平面，后续同理  
若有射影重构$\{P, P', \{X_i\}\}$，且有仿射摄像机$P = [I | 0]$，则交换 $P$ 和 $P'$ 的最后两列及每个 $X_i$ 的最后两个坐标而得到一个仿射重构  
  
#### 度量重构  
  
**IAC的约束**  
参考单视图中IAC的两种约束（正交与内参）  
来自同一摄像机的多视图对IAC的约束：  
由仿射重构确定无穷单应，进而有$\omega' = H_\infty^{-T} \omega H_\infty^{-1}$，若两视图的摄像机相同，则内参相同，则$\omega = \omega'$，由此得到一个约束  
  
**利用IAC由仿射重构恢复度量重构**  
已知某像平面IAC为$\omega$，且有仿射重构，其摄像机矩阵为$P = [M|m]$  
由$AA^T = (M^T \omega M)^{-1}$的 Cholesky 分解得到A，进而$$H = \begin{bmatrix}A^{-1} & 0 \\0^T & 1\end{bmatrix}$$  
H把仿射重构变换到度量重构  
  
  
**利用IAC直接恢复到度量重构**  
$\omega = (KK^T)^{-1}$，对$\omega$取逆并作Cholesky分解计算$K$，从而标定摄像机，结合对应点计算得到的F可以求出E（$E = K'^T F K$），进而参考上一章末由E求摄像机对  
  
  
  
## 从射影重构直接到度量重构  
已知欧式世界坐标系坐标的三维点称为地面控制点  
  
已知n个地面控制点 $\{X_{Ei}\}$，成像在$x_i \leftrightarrow x'_i$  
由对应点求出射影重构中控制点坐标$\{X_i\}$，则获取射影重构的射影变换H满足$X_{Ei} = HX_i, \quad i=1,\cdots,n$  
如此每组线性方程提供三个约束（每个点三个自由度），需5个以上一般地面控制点（最多三点共面）  
  
或者不计算$\{X_i\}$，由n个方程$x_i = PH^{-1}X_{Ei}$提供2n个约束，由此可求得H的逆（参考摄像机模型中的参数估计部分）  