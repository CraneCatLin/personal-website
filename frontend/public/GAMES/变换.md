## 仿射变换：  
$$  
\begin{gathered}  
\left \{  
\begin{array}{c}  
x'=ax+by  \\  
y'=cx+dy  
\end{array}  
\right .    
\\  
\downarrow  
\\  
\left[  
\begin{matrix}  
x'\\ y'  
\end{matrix}  
\right]  
=  
\left[  
\begin{matrix}  
a & b \\ c & d  
\end{matrix}  
\right]  
\left[  
\begin{matrix}  
x\\ y  
\end{matrix}  
\right]   
\end{gathered}  
$$  
实现旋转、缩放、切变、对称等。注意旋转是绕原点  
  
- 加入齐次坐标：  
	实现  
	$$  
	\begin{gathered}  
	\left \{  
	\begin{array}{c}  
	x'=ax+by+t_x  \\  
	y'=cx+dy+t_y  
	\end{array}  
	\right .    
	\\  
	\downarrow  
	\\  
	\left[  
	\begin{matrix}  
	x'\\ y' \\ \omega'  
	\end{matrix}  
	\right]  
	=  
	\left[  
	\begin{matrix}  
	a & b & t_x\\ c & d & t_y \\ 0 & 0 & 1   
	\end{matrix}  
	\right]  
	\left[  
	\begin{matrix}  
	x\\ y \\ 1  
	\end{matrix}  
	\right]   
	\end{gathered}  
	$$  
	此时点$(x,y,1)$ ，向量$(x,y,0)$，这种定义符合数学上点和向量的计算关系  
	点$(x,y,\omega)$表示点$(\frac{x}{\omega},\frac{y}{\omega},1)$  
	齐次坐标为0即向量  
逆变换的变换矩阵是原变换的矩阵的逆矩阵  
组合变换根据矩阵乘法即可，变换矩阵是左乘  
三维空间同理。  
- 旋转：  
	- 欧拉角  
		三维绕不同轴旋转矩阵（注意y轴的特殊性）：  
		$$  
			\begin{gathered}  
			R_x(\alpha) =   
			\begin{pmatrix}  
			1 & 0 & 0 & 0 \\  
			0 & \cos\alpha & -\sin\alpha & 0 \\  
			0 & \sin\alpha & \cos\alpha & 0 \\  
			0 & 0 & 0 & 1  
			\end{pmatrix}  
			\\  
			R_y(\alpha) =   
			\begin{pmatrix}  
			\cos\alpha & 0 & \sin\alpha & 0 \\  
			0 & 1 & 0 & 0 \\  
			-\sin\alpha & 0 & \cos\alpha & 0 \\  
			0 & 0 & 0 & 1  
			\end{pmatrix}  
			\\  
			R_z(\alpha) =   
			\begin{pmatrix}  
			\cos\alpha & -\sin\alpha & 0 & 0 \\  
			\sin\alpha & \cos\alpha & 0 & 0 \\  
			0 & 0 & 1 & 0 \\  
			0 & 0 & 0 & 1  
			\end{pmatrix}  
			\end{gathered}  
			$$  
		分解旋转，然后对应x y z轴是$\alpha \beta \gamma$   
	- Rodrigues旋转公式   
		$$  
				\begin{align*}  
				\mathbf{R}(\mathbf{n}, \alpha)   
				= \cos(\alpha) \, \mathbf{I}   
				+ (1 - \cos(\alpha)) \, \mathbf{n}\mathbf{n}^T   
				+ \sin(\alpha)   
				\underbrace{  
				\begin{pmatrix}  
				0 & -n_z & n_y \\  
				n_z & 0 & -n_x \\  
				-n_y & n_x & 0  
				\end{pmatrix}  
				}_{\mathbf{N}}  
				\end{align*}  
				$$  
	- 四元数旋转 #todo  
## 观测变换viewing  
	以下变换均应用于物体  
- 模型变换model  
	即将模型的原坐标（以自身为中心的相对坐标）变换成统一坐标系的世界坐标  
- 视图变换view/camera  
	- 相机定义：坐标，拍摄方向gaze/look at，向上方向up  
		放在标准位置：$(0,0,0)$ , gaze : -z , up : y  
		求变换矩阵：T矩阵易得，记gaze方向为$\mathbf{g}$，up方向为$\mathbf{t}$，R矩阵可以先写x轴转到$\mathbf{g}\times\mathbf{t}$，y轴旋转到$\mathbf{t}$,z轴旋转到$\mathbf{-g}$，即  
		$$  
		R^{-1}_{view} =   
		\begin{bmatrix}  
		x_{g \times t} & x_t & x_-g & 0 \\  
		y_{g \times t} & y_t & y_-g & 0 \\  
		z_{g \times t} & z_t & z_-g & 0 \\  
		0 & 0 & 0 & 1  
		\end{bmatrix}  
		$$  
		旋转矩阵正交，求逆矩阵即求转置，即  
		$$  
		R_{view} =   
		\begin{bmatrix}  
		x_{g \times t} & y_{g \times t} & z_{g \times t} & 0 \\  
		x_t & y_t & z_t & 0 \\  
		x_-g & y_-g & z_-g & 0 \\  
		0 & 0 & 0 & 1  
		\end{bmatrix}  
		$$  
		R和T合并得到相机的移动矩阵M  
	相机和物体显然相对静止，移动矩阵相同，则$M_{view}$可得  
- 投影变换project  
	投影即将三维空间投到二维平面。即对每一点作一条直线，然后取截面。在此暂时称为视线。  
	- 注：  
		n(near) f(far) l(left) r(right) t(top) b(bottom) 由于经过视图变换，摄像机在原点且朝向-z  
		方向，所以此处n和f均为负数。  
	- 正交投影orthographic projection  
		视线均平行。  
		给定一个位置的立方体，将其移到原点为中心，然后缩放成标准正方体  
		具体实现：  
			注：此处使用右手系（$\vec{z}=\vec{x}\times\vec{y}$），则$n(near)>f(far)$  
			这里是因为gaze方向沿着-z方向。如果是左手系则正好相反，$n<f$，以下公式相应修改。  
			$$  
			M_{ortho}=M_{scale}M_{translate}   
			=\begin{bmatrix}  
			\frac{2}{r-l} & 0 & 0 & 0 \\  
			0 & \frac{2}{t-b} & 0 & 0 \\  
			0 & 0 & \frac{2}{n-f} & 0 \\  
			0 & 0 & 0 & 1  
			\end{bmatrix}  
			\begin{bmatrix}  
			1 & 0 & 0 & -\frac{r+l}{2} \\  
			0 & 1 & 0 & -\frac{t+b}{2} \\  
			0 & 0 & 1 & -\frac{n+f}{2} \\  
			0 & 0 & 0 & 1  
			\end{bmatrix}  
			$$  
	- 透视投影perspective projrction  
		视线连接到同一点，即摄像机所在点，形成视锥。  
		同样是处理一个立方体，将之投影到一个四棱锥上。  
		$$  
		\begin{gathered}  
		\left\{  
		\begin{array}{c}  
		x'=\frac{n}{z}x \\  
		y'=\frac{n}{z}y   
		\end{array}  
		\right.   
		\\即\\  
		M_{persp\rightarrow ortho}  
		\left(\begin{matrix}  
		x \\ y \\ z \\ 1   
		\end{matrix}\right)  
		=\left(\begin{matrix}  
		nx \\ ny \\ unknown \\ z   
		\end{matrix}\right)  
		\end{gathered}  
		$$  
		因此矩阵$M_{persp\rightarrow ortho}$：  
		$$  
		\begin{bmatrix}  
		n & 0 & 0 & 0 \\  
		0 & n & 0 & 0 \\  
		0 & 0 & ? & ? \\  
		0 & 0 & 0 & 0  
		\end{bmatrix}  
		$$  
		这里未知数仅和点的z值有关，代入n处点和f处点，得到矩阵$M_{persp\rightarrow ortho}$：  
		$$  
			\begin{bmatrix}  
			n & 0 & 0 & 0 \\  
			0 & n & 0 & 0 \\  
			0 & 0 & n+f & -nf \\  
			0 & 0 & 1 & 0  
			\end{bmatrix}  
			$$  
		最后有矩阵$M_{persp}$：  
		$$  
			\begin{gathered}  
			M_{persp}=M_{ortho}M_{persp\rightarrow ortho}  
			\end{gathered}		  
			$$  
		由此得到投影矩阵。  
		投影最终都是处理到一个1\*1\*1的正方体内  
	- 视口变换：  
		将标准立方体变换到屏幕空间上  
		$$  
		M_{\text{viewport}} =   
		\begin{pmatrix}  
		\frac{\text{width}}{2} & 0 & 0 & \frac{\text{width}}{2} \\  
		0 & \frac{\text{height}}{2} & 0 & \frac{\text{height}}{2} \\  
		0 & 0 & 1 & 0 \\  
		0 & 0 & 0 & 1  
		\end{pmatrix}  
		$$  
		- 要特别注意的一点是，屏幕坐标喜欢用像素一角作为整数序号，而计算经常需要取像素中心  